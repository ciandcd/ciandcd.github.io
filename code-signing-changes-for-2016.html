<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>
    Code Signing Changes for 2016 - news.ciandcd.com</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="http://ciandcd.github.io/theme/css/bootstrap.css" rel="stylesheet" type="text/css"/>
  <link href="http://ciandcd.github.io/theme/css/main.css" rel="stylesheet" type="text/css"/>
  <link href="http://ciandcd.github.io/theme/css/pygment.css" rel="stylesheet" type="text/css"/>
  <link href="http://fonts.googleapis.com/css?family=Chelsea+Market" rel="stylesheet" type="text/css"/>

<script src="http://ciandcd.github.io/theme/tipuesearch/tipuesearch_content.js"></script>
<link href="http://ciandcd.github.io/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
<script src="http://ciandcd.github.io/theme/tipuesearch/tipuesearch_set.js"></script>
<script src="http://ciandcd.github.io/theme/tipuesearch/tipuesearch.min.js"></script>
<link href="http://ciandcd.github.io/feeds/rss.xml" rel="alternate" type="application/atom+xml" title="news.ciandcd.com RSS" />
<script>
$(document).ready(function() {
     $('#tipue_search_input').tipuesearch({
          'mode': 'json',
          'contentLocation': 'tipuesearch_content.json'
     });
});
</script>


  <!--[if lt IE 9]>
    <script src="https://raw.github.com/aFarkas/html5shiv/master/dist/html5shiv.js"></script>
  <![endif]-->
</head>

<!--
bootstrap-itech - a Pelican theme using Bootstrap
-->
<body>

<!-- Header -->
<header>
<div class="container-fluid">
<h1 class="page-header"><a href="http://ciandcd.github.io/index.html">news.ciandcd.com </a>
<h4>软件持续集成和发布</h4></h1>
</div>
</header>
<!-- /Header -->

<nav class="navbar navbar-default">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://ciandcd.github.io/index.html"></a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

  <li><a href="http://ciandcd.github.io/index.html">首页</a></li>

  <li class="active"><a href="http://ciandcd.github.io/category/ciandcd.html">ciandcd</a></li>
  <li ><a href="http://ciandcd.github.io/category/devops.html">devops</a></li>
  <li ><a href="http://ciandcd.github.io/category/scm.html">scm</a></li>

  
    <li ><a href="http://ciandcd.github.io/pages/about.html">about</a></li>
    <li ><a href="http://ciandcd.github.io/pages/awesome.html">Awesome</a></li>


</ul>
      <form class="navbar-form navbar-left navbar-search" role="search" action="http://ciandcd.github.io/search.html onsubmit="return validateForm(this.elements['q'].value);">
        <div class="form-group search-query">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
      </form>

      <ul class="nav navbar-nav navbar-right">
        <li><a href="http://www.cnblogs.com/itech">itech</a></li>
        <li><a href="https://github.com/ciandcd">Github</a></li>
      </ul>

    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

<!-- Body -->
<section id="body">
<div class="container">

<!-- Nav bar -->
<!-- /Nav bar -->

<!-- Main block -->
<div class="row">

<!-- Content -->
<div class="col-lg-9">
<article>
<h2>
    Code Signing Changes for 2016</h2>
From:<a href="https://www.finalbuilder.com/resources/blogs/postid/742/code-signing-changes-for-2016">https://www.finalbuilder.com/resources/blogs/postid/742/code-signing-changes-for-2016</a><br><br><div><a></a><br><h3> What do I need to do?</h3>
First things first, check your code signing certificate. If it's current, and uses SHA1, contact your certificate issuer for a replacement SHA256 certificate. Most issuers have a formal process for this since this is something they have known about for a while and should not charge extra (KSoftware/Comodo do not charge). In our case, our certificate was renewed in Nov 2014 and was already an SHA256 certificate.&#160;<br><br><h3> What if I need to support Windows XP/Server 2003?</h3>
Windows XP &amp; Server 2003 do not support SHA256, so this deprecation of SHA1 does not apply to those versions of windows. If you sign with your SHA256 certificate using the SHA256 digest algorithm, you will find you code is not trusted on those versions of windows. The trick is to use the SHA1 digest algorithm.&#160; &#160; <br><br><h3>So do I need separate installers for XP and Windows 7+ ? </h3>
Well that's one way to do it, but you can support XP and windows 7+ with a single installer or exe, by signing twice, with SHA1 and SHA256.&#160; <br><br>
NOTE: If you are a long time FinalBuilder user and still using the Authenticode action, then don't, it's been deprecated for some time as it uses the <a></a><br><br>
Recent versions of <a></a><br><br>
In my experiments, I found that you need to sign with SHA1 first, then SHA256. The reason for this is that WinXP only looks at the first signature and would not recognise the timestamps from any RFC3161 timestamp servers that I tried. The signtool options that allow adding additional signatures (/as for signing, /tp for timestamping) only work with RFC3161 compliant timestamp servers, so the SHA1 signature and timestamp must be done first since we can't use /as or /tp with a non RFC3161 timestamp server.&#160;<br><br><h3> Sign, then TimeStamp</h3>
Whilst signtool can sign and timestamp in a single operation (and the <a></a><br><br>
By doing the timestamp operation separately, we can retry if timestamping fails. Often, just a few seconds between retries is enough (unless your internet connection is down), and there is always the option of using a different timestamp server. &#160; <br><br>
So the order of events is :<br><br>
Sign SHA1.<br>
Sign SHA256 (with append signature /as).<br>
Timestamp SHA1 - using older style authenticode timestamp server.<br>
Timestamp SHA256 (/tp <p>with index 1&#160;</p>) - using an RFC3161 compliant timestamp server.<br><br><h3>Show me how!</h3>
I have created an examples repository on github : <a></a><br><br><h3>
References</h3>
<a href="https://www.comodo.com/e-commerce/SHA-2-transition.php" target="_blank">https://www.comodo.com/e-commerce/SHA-2-transition.php</a><br><a class="moz-txt-link-freetext" href="http://social.technet.microsoft.com/wiki/contents/articles/32288.windows-enforcement-of-authenticode-code-signing-and-timestamping.aspx" target="_blank">http://social.technet.microsoft.com/wiki/contents/articles/32288.windows-enforcement-of-authenticode-code-signing-and-timestamping.aspx</a>\&#13;
                        <br><br><br><br> &#13;
                    <p>Microsoft announced some time ago that windows 7 &amp; higher would no longer trust anything that is code signed with an SHA1 ( <a class="moz-txt-link-freetext" href="https://en.wikipedia.org/wiki/SHA-1">https://en.wikipedia.org/wiki/SHA-1</a> ) certificate as of 1st Jan 2016. The reason for this is well documented, SHA1 has become increasingly vulnerable and is no longer secure enough to be trusted.First things first, check your code signing certificate. If it's current, and uses SHA1, contact your certificate issuer for a replacement SHA256 certificate. Most issuers have a formal process for this since this is something they have known about for a while and should not charge extra (KSoftware/Comodo do not charge). In our case, our certificate was renewed in Nov 2014 and was already an SHA256 certificate.Windows XP &amp; Server 2003 do not support SHA256, so this deprecation of SHA1 does not apply to those versions of windows. If you sign with your SHA256 certificate using the SHA256 digest algorithm, you will find you code is not trusted on those versions of windows. The trick is to use the SHA1 digest algorithm.Well that's one way to do it, but you can support XP and windows 7+ with a single installer or exe, by signing twice, with SHA1 and SHA256.NOTE: If you are a long time FinalBuilder user and still using the Authenticode action, then don't, it's been deprecated for some time as it uses the <a href="http://blogs.msdn.com/b/karinm/archive/2009/01/19/capicom-dll-removed-from-windows-sdk-for-windows-7.aspx" target="_blank" title="Capicom deprecated blog post.">deprecated capicom.dll api</a> . The only reason we haven't removed it is to avoid errors when you load your old projects. The correct actions to use for code signing are the SignTool actions.Recent versions of <a href="https://msdn.microsoft.com/en-us/library/8s9b9yaz(v=vs.110).aspx" target="_blank" title="Signtool documentation.">Signtool.exe</a> include a switch (/as) to append a signature ( the default operation is to replace the primary signature). I believe the windows 8.1 sdk was the first version to include this option (and other related options).In my experiments, I found that you need to sign with SHA1 first, then SHA256. The reason for this is that WinXP only looks at the first signature and would not recognise the timestamps from any RFC3161 timestamp servers that I tried. The signtool options that allow adding additional signatures (/as for signing, /tp for timestamping) only work with RFC3161 compliant timestamp servers, so the SHA1 signature and timestamp must be done first since we can't use /as or /tp with a non RFC3161 timestamp server.Whilst signtool can sign and timestamp in a single operation (and the <a href="http://wiki.finalbuilder.com/display/FB8/Signtool+Sign+Files+Action" target="_blank" title="Signtool Sign Action help.">SignTool Sign</a> action in FinalBuilder can too), I prefer to do the timestamp step separately. The reason for this is that signing rarely fails (typically only when the certificate has expired or you get the password wrong!), but timestamping fails often, because the timestamp server may be unreachable or it just has some issue and doesn't respond correctly.By doing the timestamp operation separately, we can retry if timestamping fails. Often, just a few seconds between retries is enough (unless your internet connection is down), and there is always the option of using a different timestamp server.So the order of events is :Sign SHA1.Sign SHA256 (with append signature /as).Timestamp SHA1 - using older style authenticode timestamp server.Timestamp SHA256 (/tp) - using an RFC3161 compliant timestamp server.I have created an examples repository on github : <a href="https://github.com/VSoftTechnologies/FinalBuilder.Examples" target="_blank">FinalBuilder Examples</a> - you can find a nice example there showing how to double (optionally) sign and then timestamp (with retries). This example requires FinalBuilder 8.0.0.1490 or later (added support for /tp option on timestamp action).</p></div>

<p class="info">
<h4>
Posted Wed 20 January 2016
 by <a class="url fn" href="http://ciandcd.github.io/author/itech001.html">itech001</a>
in <a href="http://ciandcd.github.io/category/ciandcd.html">ciandcd</a>
(<a href="http://ciandcd.github.io/tag/finalbuilder.html">finalbuilder</a>)</h4></p>

</article>
</div>
<!-- /Content -->

<!-- Side bar -->
<nav class="col-lg-3">

<h2>分类</h2>
<ul class="nav nav-pills nav-stacked">
  <li class="active"><a href="http://ciandcd.github.io/category/ciandcd.html">ciandcd</a></li>
  <li ><a href="http://ciandcd.github.io/category/devops.html">devops</a></li>
  <li ><a href="http://ciandcd.github.io/category/scm.html">scm</a></li>
</ul>

<h2>标签</h2>
<ul class="tagcloud">
        <li class="tag-1"><a href="http://ciandcd.github.io/tag/finalbuilder.html">finalbuilder</a></li>
        <li class="tag-1"><a href="http://ciandcd.github.io/tag/jenkins.html">jenkins</a></li>
        <li class="tag-1"><a href="http://ciandcd.github.io/tag/devops.html">devops</a></li>
        <li class="tag-2"><a href="http://ciandcd.github.io/tag/ciandcd.html">ciandcd</a></li>
        <li class="tag-2"><a href="http://ciandcd.github.io/tag/perforce.html">perforce</a></li>
</ul>

<h2>链接</h2>
<ul class="nav nav-pills nav-stacked">
  <li><a href="http://www.cnblogs.com/itech/">itech</a></li>
  <li><a href="http://www.ciandcd.com">ciandcd</a></li>
</ul>

<h2>联系</h2>
<ul class="nav nav-pills nav-stacked">
  <li><a href="http://ciandcd.github.io/feeds/rss.xml" type="application/rss+xml" rel="alternate">Site Feed</a></li>
  <li><a href="https://github.com/ciandcd">Github</a></li>
</ul>

<h2>作者</h2>
<ul class="nav nav-pills nav-stacked">
  <li ><a href="http://ciandcd.github.io/author/about-the-author.html">About The Author</a></li>
  <li ><a href="http://ciandcd.github.io/author/alex-staveley.html">Alex Staveley</a></li>
  <li ><a href="http://ciandcd.github.io/author/antti-virtanen.html">Antti Virtanen</a></li>
  <li ><a href="http://ciandcd.github.io/author/barton-george.html">Barton George</a></li>
  <li ><a href="http://ciandcd.github.io/author/elizabeth-geno.html">Elizabeth Geno</a></li>
  <li ><a href="http://ciandcd.github.io/author/florian-motlik.html">Florian Motlik</a></li>
  <li ><a href="http://ciandcd.github.io/author/gene-kim.html">Gene Kim</a></li>
  <li ><a href="http://ciandcd.github.io/author/itech001.html">itech001</a></li>
  <li ><a href="http://ciandcd.github.io/author/jez-humble.html">Jez Humble</a></li>
  <li ><a href="http://ciandcd.github.io/author/john-cook.html">John Cook</a></li>
  <li ><a href="http://ciandcd.github.io/author/john-esser.html">John Esser</a></li>
  <li ><a href="http://ciandcd.github.io/author/jules-louis.html">Jules Louis</a></li>
  <li ><a href="http://ciandcd.github.io/author/jullietta-jung.html">Jullietta Jung</a></li>
  <li ><a href="http://ciandcd.github.io/author/kobi-halperin.html">Kobi Halperin</a></li>
  <li ><a href="http://ciandcd.github.io/author/meta-brown.html">Meta Brown</a></li>
  <li ><a href="http://ciandcd.github.io/author/michelle-d-souza.html">Michelle D Souza</a></li>
  <li ><a href="http://ciandcd.github.io/author/nathaniel-eliot.html">Nathaniel Eliot</a></li>
  <li ><a href="http://ciandcd.github.io/author/patrik-carlos.html">Patrik Carlos</a></li>
  <li ><a href="http://ciandcd.github.io/author/peter-spung.html">Peter Spung</a></li>
  <li ><a href="http://ciandcd.github.io/author/piotr-oktaba.html">Piotr Oktaba</a></li>
  <li ><a href="http://ciandcd.github.io/author/ragnar-lonn.html">Ragnar Lönn</a></li>
  <li ><a href="http://ciandcd.github.io/author/ralph-tice.html">Ralph Tice</a></li>
  <li ><a href="http://ciandcd.github.io/author/scuzza-man.html">Scuzza Man</a></li>
  <li ><a href="http://ciandcd.github.io/author/sven-malvik.html">Sven Malvik</a></li>
  <li ><a href="http://ciandcd.github.io/author/tony-bradley.html">Tony Bradley</a></li>
  <li ><a href="http://ciandcd.github.io/author/william-pietri.html">William Pietri</a></li>
  <li ><a href="http://ciandcd.github.io/author/yegor-bugayenko.html">Yegor Bugayenko</a></li>
</ul>

</nav>
<!-- /Side bar -->

</div>
<!-- /Main block -->

<!-- Footer -->
<div class="row"><div class="col-lg-12">
<footer><small>
软件持续集成和持续发布 QQ群：172758282. <a target="_blank" href="http://shang.qq.com/wpa/qunwpa?idkey=d15cb26237b499f41b21a6e95ddc436766a383a725106a92bd69cdf860a64d34"><img border="0" src="http://pub.idqqimg.com/wpa/images/group.png" alt="ciandcd.com" title="ciandcd.com"></a>
</small></footer>
</div></div>
<!-- /Footer -->

</div></section>
<!-- /Body -->

<script src="http://ciandcd.github.io/theme/js/jquery.js"></script>
<script src="http://ciandcd.github.io/theme/js/bootstrap.js"></script>


</body>
</html>